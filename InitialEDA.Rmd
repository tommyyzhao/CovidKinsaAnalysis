---
title: "Covid & Kinsa Preliminary EDA"
author: "Thomas Zhao"
date: "04/07/2020"
output: 
    html_notebook:
    fig_height: 6
    fig_width: 10
---
```{r, echo=FALSE, results='hide'}
# clean up the RStudio environment 
rm(list = ls())
# load all packages used
library(dplyr)
library(mosaic)
library(leaflet)
library(tidyverse)
library(lubridate)
library(DataComputing)
```

## Guiding Question
Can we make predictions and/or find useful correlations in Covid data using [Kinsa's](https://www.kinsahealth.co/enterprise/kinsa-insights/) health data?


### Data source #1
Who: New York Times

What: data on coronavirus cases and deaths in the U.S.

Where: the U.S.

When: 01/21/2020 to Present

Why: The Times maintain this dataset in an attempt to provide a complete record of the ongoing outbreak

The New York Times maintains a handy [Github repo](https://github.com/nytimes/covid-19-data) of the most recent data regarding Covid-19. Within are two csv files which contain data on Covid-19 cases at the county-level & state-level. We'll be focusing on county-level data (where each case represents a Covid cases in a county on a given date) since our other data source is county-level as well. 

Below, we load the most recent nytimes data directly from their Github.

```{r}
library("RCurl")

x <- getURL("https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv")
Covid <- read.csv(text = x, header=TRUE)

head(Covid)
nrow(Covid)
```
 As of 4/7/2020, we have 38197 rows in the data frame.


### Data source #2
Who: [Kinsa](https://www.kinsahealth.co/)

What: data on influenza-like incidents (ili) aggregated from Kinsa's smart thermometers

Where: the U.S.

When: 02/16/2020 to Present

Why: To track (and perhaps predict) the spread of contagious illnesses


Our second source of data is Kinsa's public health API, which aggregates data from Kinsa's [smart thermometers](https://www.kinsahealth.co/products/#buynow). The API base url is "https://static.kinsahealth.com". Details on how the data was extracted from the API can be found in the Python file in this repository.

Let's have a look at the Kinsa data
```{r}
KinsaData <- read.csv("kinsa_county_data.csv")

head(KinsaData)
nrow(KinsaData)
```
Just like the Covid data, each case represents observations in a county on a given data. In this case, the observation is "observed_ili," which is the observed influenza-like illness (ili) rate which Kinsa aggregates from all its thermometers. Kinsa also provides other useful variables, such as forecast_expected, which is the expected (historical) ili rate in that county, and anomaly_diff, which is the difference between the observed_ili and forecast_expected. We will be focusing on anomaly_diff and observed_ili mainly.

For more info on the details of these variables, see here: https://content.kinsahealth.com/covid-detection-technical-approach

Note that we have significantly more cases in Kinsa data than Covid. We will have to filter for only counties affected by Covid later.

##Preliminary EDA
First we need to reformat some of the data
```{r}
Covid <- Covid %>%
  mutate(date = ymd(date))

KinsaData <- KinsaData %>%
  mutate(date = ymd(date))
```


Let's see how Covid cases in New York City evolved to get a feel for the data:

```{r}
cases_NYC <- Covid %>%
  filter(state == "New York") %>%
  filter(county == "New York City")

summary(cases_NYC)
```
```{r}
ggplot(data=cases_NYC,aes(x=date,y=cases))+geom_line() 
```

This is consistent with the news so far... let's see what the Kinsa data looks like for New York County aka Manhattan (they don't have New York City as a whole unfortunately).
```{r}
Kinsa_NY <- KinsaData %>% 
  filter(region_id == 36061) #this is the fips code for New York County

ggplot(data=Kinsa_NY, aes(x = date, y = observed_ili)) + 
        geom_line() + 
        xlim(mdy("3/1/2020"), mdy("4/6/2020"))
```
Observed ili peaks around Mar 18, but this doesn't tell us too much. A side-by-side view will allow us to compare the two better
```{r}
require(gridExtra)
plot1 <- ggplot(data=cases_NYC,aes(x=date,y=cases))+geom_line() 
plot2 <- ggplot(data=Kinsa_NY, aes(x = date, y = observed_ili)) + 
        geom_line() + 
        xlim(mdy("3/1/2020"), mdy("4/6/2020"))
grid.arrange(plot1, plot2, ncol=1)
```
We see that observed_ili steadily rises up until the Covid cases start growing significantly around Mar 18. After that it starts declining, which is interesting, but let's examine the anomaly_diff in the data for New York County.

```{r}
plot1 <- ggplot(data=cases_NYC,aes(x=date,y=cases))+geom_line() 
plot2 <- ggplot(data=Kinsa_NY, aes(x = date, y = anomaly_diff)) + 
        geom_line() + 
        xlim(mdy("3/1/2020"), mdy("4/6/2020"))
grid.arrange(plot1, plot2, ncol=1)

```
The anomaly_diff seems to peak around the start of the Covid cases being recorded, so there is clearly some sort of correlation going on here. 

Further statistical analysis will be needed, as well as a country-wide approach to determine the total "effectiveness" of Kinsa's data in predicting Covid. Looking at the cross-correlation between observed_ili and Covid cases would tell us a lot about the predictive capability of Kinsa's data.  
